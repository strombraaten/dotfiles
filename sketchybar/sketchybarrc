#!/bin/bash

# Vertical SketchyBar Configuration
# Inspired by https://github.com/iyioon/sketchybar
# Modified for left-side vertical layout

PLUGIN_DIR="$CONFIG_DIR/plugins"

# Theme colors (cyberdream)
BG_COLOR="0xff16181a"
FG_COLOR="0xffe0e0e0"
DIM_COLOR="0xff7b8496"
ACCENT_COLOR="0xffff5ef1"
BORDER_COLOR="0xff2a3a4a"

##### Bar Appearance #####
# Horizontal bar positioned at the bottom with better spacing
sketchybar --bar position=bottom \
                height=40 \
                sticky=on \
                topmost=off \
                shadow=on \
                y_offset=0 \
                margin=15 \
                padding_left=20 \
                padding_right=20 \
                color=$BG_COLOR \
                border_color=$BORDER_COLOR \
                border_width=1 \
                corner_radius=10 \
                font_smoothing=on

##### Changing Defaults #####
# Updated defaults for unified pill-style layout
sketchybar --default icon.font="SF Pro:Semibold:14.0" \
                     icon.color=$FG_COLOR \
                     label.font="SF Pro:Semibold:14.0" \
                     label.color=$FG_COLOR \
                     padding_left=3 \
                     padding_right=3 \
                     icon.padding_left=6 \
                     icon.padding_right=3 \
                     label.padding_left=6 \
                     label.padding_right=3 \
                     background.corner_radius=15 \
                     background.height=28 \
                     background.color=$BG_COLOR \
                     background.drawing=off

##### Adding Workspace Indicators with App Icons #####
for sid in $(seq 1 5); do
  sketchybar --add item space.$sid left \
             --set space.$sid \
               icon.drawing=off \
               label="$sid" \
               label.color=$FG_COLOR \
               click_script="aerospace workspace $sid" \
               script="$PLUGIN_DIR/workspace_apps.sh" \
               update_freq=5
done

# Add custom event for workspace changes
sketchybar --add event aerospace_workspace_change

# Subscribe all workspaces to multiple events for better responsiveness
for sid in $(seq 1 5); do
  sketchybar --subscribe space.$sid aerospace_workspace_change space_change front_app_switched
done

# Separator between spaces and front app
sketchybar --add item space_separator left \
           --set space_separator \
             icon=" " \
             label.drawing=off \
             background.drawing=off

# Front app indicator with emoji icons
sketchybar --add item front_app left \
           --set front_app \
             script="$PLUGIN_DIR/front_app.sh" \
             icon.drawing=on \
             label.color=$FG_COLOR \
           --subscribe front_app front_app_switched

##### Adding System Items (Bottom Section) #####
# Battery (commented out)
# sketchybar --add item battery right \
#            --set battery \
#              script="$PLUGIN_DIR/battery.sh" \
#              update_freq=120 \
#              label.color=$FG_COLOR \
#              icon.color=$FG_COLOR
# sketchybar --subscribe battery system_woke power_source_change

# Volume (commented out)
# sketchybar --add item volume right \
#            --set volume \
#              script="$PLUGIN_DIR/volume.sh" \
#              label.color=$FG_COLOR \
#              icon.color=$FG_COLOR
# sketchybar --subscribe volume volume_change

# Clock
sketchybar --add item clock right \
           --set clock \
             script="$PLUGIN_DIR/clock.sh" \
             update_freq=30 \
             icon.drawing=off \
             label.font="SF Pro:Regular:14" \
             label.color=$FG_COLOR \
             padding_left=32 \
             padding_right=8

##### Force all scripts to run the first time #####
sketchybar --update

# Initial update of workspace indicators
$PLUGIN_DIR/workspace_apps.sh
